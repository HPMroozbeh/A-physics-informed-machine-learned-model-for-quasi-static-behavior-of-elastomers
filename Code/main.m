
%%%% This code is written by Aref Ghaderi, ghaderi1@msu.edu
%%%% arefghaderi1372@gmail.com 

clc; clear;
%%%%% Initial Weights %%%%
W_0 = [.4 -.4 .4 .4 .4 -.4 .4 .4 .4 -.4 .4 .4 .4 -.4 .4 .4 .4 -.4 .4 .4 .4 -.4 .4 .4 .4 -.4 .4 .4 .4 -.4 .4 .4]/7;

%%%%% Constraint to gurantee thermodynamic consistency %%%%%
lb = [-1000, -1000, 0, 0,-1000, -1000, 0, 0,-1000, -1000, 0, 0,-1000, -1000, 0, 0,-1000, -1000, 0, 0,-1000, -1000, 0, 0,-1000, -1000, 0, 0,-1000, -1000, 0, 0]; 
ub = [1000, 0, 1000, 1000,1000, 0, 1000, 1000,1000, 0, 1000, 1000,1000, 0, 1000, 1000,1000, 0, 1000, 1000,1000, 0, 1000, 1000,1000, 0, 1000, 1000,1000, 0, 1000, 1000];      

%%%%% Optimizer %%%%%
fun = @(x)func_training([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16) x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]);
A = [];
b = [];
Aeq = [];
beq = [];
nonlcon = [];
options = optimoptions('fmincon','Display','iter','Algorithm','sqp');
[x,fval,exitflag,output] = fmincon(fun,W_0,A,b,Aeq,beq,lb,ub,nonlcon,options);

%%% Experimental Data Uniaxial for Loading(L) and Unloading(U) %%%%
stretch_L = [1,1.02340000000000,1.04200000000000,1.06070000000000,1.11090000000000,1.17370000000000,1.25530000000000,1.34330000000000,1.44390000000000,1.54450000000000,1.65140000000000,1.74580000000000,1.84640000000000,1.90750000000000,1.94680000000000,2.04130000000000,2.12920000000000,2.21720000000000,2.29890000000000,2.37430000000000,2.44970000000000,2.53140000000000,2.60050000000000,2.64520000000000,2.68220000000000,2.75740000000000,2.83290000000000,2.89570000000000,2.93970000000000];
stretch_U = [2.93970000000000,2.93990000000000,2.92750000000000,2.90880000000000,2.89020000000000,2.87150000000000,2.85280000000000,2.82150000000000,2.79030000000000,2.74640000000000,2.70880000000000,2.64610000000000,2.57700000000000,2.50160000000000,2.41990000000000,2.31300000000000,2.21240000000000,2.08660000000000,1.97960000000000,1.84750000000000,1.73430000000000,1.60850000000000,1.50780000000000,1.40090000000000,1.30660000000000,1.21860000000000,1.13690000000000];
stress_L = [0,0.225600000000000,0.417700000000000,0.609700000000000,0.801400000000000,0.974000000000000,1.12710000000000,1.28010000000000,1.41390000000000,1.54760000000000,1.70060000000000,1.81510000000000,1.94890000000000,1.96110000000000,2.10180000000000,2.23560000000000,2.38870000000000,2.54170000000000,2.69490000000000,2.84790000000000,3.00120000000000,3.17350000000000,3.32670000000000,3.38680000000000,3.47990000000000,3.65220000000000,3.82460000000000,3.97790000000000,4.07350000000000];
stress_U = [4.07350000000000,3.91990000000000,3.72780000000000,3.53580000000000,3.32450000000000,3.13250000000000,2.94050000000000,2.74850000000000,2.55660000000000,2.36470000000000,2.17290000000000,1.98110000000000,1.80870000000000,1.65560000000000,1.50250000000000,1.36880000000000,1.23490000000000,1.13990000000000,1.02540000000000,0.911100000000000,0.815900000000000,0.701600000000000,0.606300000000000,0.472600000000000,0.338800000000000,0.185700000000000,0];

%%%% Experimental Data Shear for Loading(L) and Unloading(U) %%%%%
stretch_L_S = [1,1.02490000000000,1.05420000000000,1.11910000000000,1.23720000000000,1.40860000000000,1.59770000000000,1.79880000000000,1.80920000000000,1.98200000000000,2.14160000000000,2.23910000000000,2.30710000000000,2.44890000000000,2.58480000000000,2.70880000000000,2.82100000000000,2.92720000000000,3.02170000000000,3.07480000000000];
stretch_U_S = [3.07480000000000,3.06310000000000,3.04560000000000,3.02810000000000,2.99290000000000,2.96350000000000,2.91630000000000,2.85750000000000,2.78080000000000,2.69230000000000,2.55640000000000,2.38500000000000,2.18400000000000,1.97710000000000,1.74650000000000,1.53350000000000,1.36220000000000,1.23220000000000];
stress_L_S = [0,0.402600000000000,0.805200000000000,1.17120000000000,1.55560000000000,1.84840000000000,2.10460000000000,2.37910000000000,2.38000000000000,2.65360000000000,2.96470000000000,3.15170000000000,3.27580000000000,3.62350000000000,3.97120000000000,4.35560000000000,4.73990000000000,5.10590000000000,5.49020000000000,5.65490000000000];
stress_U_S = [5.65490000000000,5.45360000000000,5.05100000000000,4.66670000000000,4.26410000000000,3.87970000000000,3.47710000000000,3.09280000000000,2.70850000000000,2.32420000000000,1.99480000000000,1.70200000000000,1.40920000000000,1.17120000000000,0.915000000000000,0.677100000000000,0.366000000000000,0];

%%%% Experimental Data Biaxial for Loading(L) and Unloading(U) %%%%%
stretch_L_B = [1,1.00570000000000,1.02920000000000,1.05850000000000,1.13510000000000,1.28840000000000,1.47130000000000,1.63060000000000,1.77800000000000,1.82620000000000,1.91360000000000,2.01970000000000,2.14360000000000,2.23190000000000,2.24220000000000,2.33210000000000,2.41460000000000,2.50300000000000,2.57960000000000,2.65620000000000];
stretch_U_B = [2.65620000000000,2.64440000000000,2.63290000000000,2.61540000000000,2.59180000000000,2.57440000000000,2.53910000000000,2.49800000000000,2.44500000000000,2.38010000000000,2.29180000000000,2.18570000000000,2.02650000000000,1.85540000000000,1.67840000000000,1.48970000000000,1.34220000000000,1.24200000000000];
stress_L_B = [0,0.419600000000000,0.821100000000000,1.22260000000000,1.60610000000000,1.91740000000000,2.21060000000000,2.54010000000000,2.86950000000000,2.90260000000000,3.23530000000000,3.60090000000000,3.94840000000000,4.31390000000000,4.35000000000000,4.71590000000000,5.08130000000000,5.46500000000000,5.84870000000000,6.19580000000000];
stress_U_B = [6.19580000000000,5.81270000000000,5.41130000000000,5.02810000000000,4.62660000000000,4.22520000000000,3.82350000000000,3.44020000000000,3.05680000000000,2.67330000000000,2.28960000000000,1.92400000000000,1.59450000000000,1.28310000000000,1.00820000000000,0.733200000000000,0.403800000000000,0];

%%%%% Prediction Stretch %%%%%
stretch_LL = linspace(1,2.9397,50); %%%% Uniaxial Loading %%%
stretch_UU = linspace(2.9397,1.1369,50); %%%% Uniaxial Unloading %%%

stretch_LL1 = linspace(1,3.0748,50); %%%% Shear Loading %%%
stretch_UU1 = linspace(3.0748,1.2322,50); %%%% Shear Unloading %%%

stretch_LL2 = linspace(1,2.6562,50); %%%% Biaxial Loading %%%
stretch_UU2 = linspace(2.6562,1.242,50); %%%% Biaxial Unloading %%%

%%%% Predicted stress for uniaxial, shear, and Biaxial %%%%

[L_U,U_U] = func_prediction_uniaxial([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Uniaxial prediction%%%%
[L_S,U_S] = func_prediction_shear([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Shear prediction%%%%
[L_B,U_B] = func_prediction_biaxial([x(1) x(2) x(3) x(4) x(5) x(6) x(7) x(8) x(9) x(10) x(11) x(12) x(13) x(14) x(15) x(16)  x(17) x(18) x(19) x(20) x(21) x(22) x(23) x(24) x(25) x(26) x(27) x(28) x(29) x(30) x(31) x(32)]); %%% Biaxial prediction%%%

figure(1)
hold on
plot(stretch_L_B, stress_L_B, '*');
plot(stretch_U_B, stress_U_B, '*');
plot(stretch_LL2, L_B, 'k');
plot(stretch_UU2, U_B, 'k');
title('Biaxial')


figure(2)
hold on
plot(stretch_L,stress_L,'o')
plot(stretch_U,stress_U,'o')
plot(stretch_LL, L_U, 'r')
plot(stretch_UU, U_U, 'r')
title('Uniaxial')


figure(3)
hold on
plot(stretch_L_S,stress_L_S, '+')
plot(stretch_U_S,stress_U_S, '+')
plot(stretch_LL1, L_S, 'b')
plot(stretch_UU1, U_S, 'b')
title('Shear')

xlabel('Stretch ','FontSize',16,'FontWeight','b', 'FontAngle', 'i','FontName','Times New Roman');
ylabel('Stress','FontSize',16,'FontWeight','b', 'FontAngle', 'i','FontName','Times New Roman');
 

